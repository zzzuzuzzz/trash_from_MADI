<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>game</title>
  <style>
    body {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #myCanvas {
      border: 1px solid black;
    }
  </style>
</head>
<body>
<canvas id="myCanvas" width="1000" height="600"></canvas>
<script>
  const canvas = document.getElementById("myCanvas");
  const ctx = canvas.getContext("2d");
  const map = [
          [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
          [1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1],
          [1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1],
          [1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1],
          [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],
          [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],
          [1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1],
          [1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1],
          [1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1],
          [1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1],
          [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
  ];
  let test = [
    [0, 0],
    [250, 150],
    [250, 450],
    [0, 600],
    [1000, 0],
    [750, 150],
    [750, 450],
    [1000, 600],
  ];
  let playerPlace = [1,1]
  let win = [9,9]
  let playerDirection = 'bottom';





  function blockLeftWall(date) {
    ctx.beginPath();
    ctx.moveTo(date[0][0], date[0][1]);
    ctx.lineTo(date[1][0], date[1][1]);
    ctx.lineTo(date[2][0], date[2][1]);
    ctx.lineTo(date[3][0], date[3][1]);
    ctx.closePath();
    ctx.stroke();
    ctx.fillStyle = "rgb(152,152,152)";
    ctx.fill();
  }
  function blockLeftDoor(date) {
    ctx.beginPath();
    ctx.moveTo(date[0][0], date[0][1]);
    ctx.lineTo(date[1][0], date[1][1]);
    ctx.lineTo(date[2][0], date[2][1]);
    ctx.lineTo(date[3][0], date[3][1]);
    ctx.closePath();
    ctx.stroke();
    ctx.fillStyle = "rgb(238,238,238)";
    ctx.fill();

    ctx.beginPath();
    ctx.moveTo(date[0][0], date[1][1]);
    ctx.lineTo(date[1][0], date[1][1]);
    ctx.lineTo(date[2][0], date[2][1]);
    ctx.lineTo(date[3][0], date[2][1]);
    ctx.closePath();
    ctx.stroke();
    ctx.fillStyle = "rgb(152,152,152)";
    ctx.fill();
  }

  function blockLeftNull(date) {
    ctx.beginPath();
    ctx.moveTo(date[0][0], date[0][1]);
    ctx.lineTo(date[1][0], date[1][1]);
    ctx.lineTo(date[2][0], date[2][1]);
    ctx.lineTo(date[3][0], date[3][1]);
    ctx.closePath();
    ctx.stroke();
    ctx.fillStyle = "rgb(238,238,238)";
    ctx.fill();

    ctx.beginPath();
    ctx.moveTo(date[0][0], date[1][1]);
    ctx.lineTo(date[1][0], date[1][1]);
    ctx.lineTo(date[2][0], date[2][1]);
    ctx.lineTo(date[3][0], date[2][1]);
    ctx.closePath();
    ctx.stroke();
    ctx.fillStyle = "rgb(152,152,152)";
    ctx.fill();
  }




  function blockRightWall(date) {
    ctx.beginPath();
    ctx.moveTo(date[4][0], date[4][1]);
    ctx.lineTo(date[5][0], date[5][1]);
    ctx.lineTo(date[6][0], date[6][1]);
    ctx.lineTo(date[7][0], date[7][1]);
    ctx.closePath();
    ctx.stroke();
    ctx.fillStyle = "rgb(152,152,152)";
    ctx.fill();
  }
  function blockRightDoor(date) {
    ctx.beginPath();
    ctx.moveTo(date[4][0], date[4][1]);
    ctx.lineTo(date[5][0], date[5][1]);
    ctx.lineTo(date[6][0], date[6][1]);
    ctx.lineTo(date[7][0], date[7][1]);
    ctx.closePath();
    ctx.stroke();
    ctx.fillStyle = "rgb(238,238,238)";
    ctx.fill();

    ctx.beginPath();
    ctx.moveTo(date[4][0], date[5][1]);
    ctx.lineTo(date[5][0], date[5][1]);
    ctx.lineTo(date[6][0], date[6][1]);
    ctx.lineTo(date[7][0], date[6][1]);
    ctx.closePath();
    ctx.stroke();
    ctx.fillStyle = "rgb(152,152,152)";
    ctx.fill();
  }





  function upAndDown(date) {
    ctx.beginPath();
    ctx.moveTo(date[0][0], date[0][1]);
    ctx.lineTo(date[4][0], date[4][1]);
    ctx.lineTo(date[5][0], date[5][1]);
    ctx.lineTo(date[1][0], date[1][1]);
    ctx.closePath();
    ctx.stroke();
    ctx.fillStyle = "rgb(238,238,238)";
    ctx.fill();

    ctx.beginPath();
    ctx.moveTo(date[3][0], date[3][1]);
    ctx.lineTo(date[7][0], date[7][1]);
    ctx.lineTo(date[6][0], date[6][1]);
    ctx.lineTo(date[2][0], date[2][1]);
    ctx.closePath();
    ctx.stroke();
    ctx.fillStyle = "rgb(238,238,238)";
    ctx.fill();
  }
  function wall(date) {
    ctx.beginPath();
    ctx.moveTo(date[1][0], date[1][1]);
    ctx.lineTo(date[5][0], date[5][1]);
    ctx.lineTo(date[6][0], date[6][1]);
    ctx.lineTo(date[2][0], date[2][1]);
    ctx.closePath();
    ctx.stroke();
    ctx.fillStyle = "rgb(152,152,152)";
    ctx.fill();
  }

  function drawMap() {
    ctx.beginPath();
    ctx.moveTo(1000, 0);
    ctx.lineTo(800, 0);
    ctx.lineTo(800, 200);
    ctx.lineTo(1000, 200);
    ctx.closePath();
    ctx.stroke();


    map.forEach(function(elem, ind) {
      ctx.beginPath();
      ctx.moveTo(1000, 0);
      ctx.lineTo(800, 0);
      ctx.lineTo(800, 200/map.length * (ind + 1));
      ctx.lineTo(1000, 200/map.length * (ind + 1));
      ctx.closePath();
      ctx.stroke();
      elem.forEach(function (el, id) {
        ctx.beginPath();
        ctx.moveTo(id === 0 ? 800 : (800 + 200/elem.length * id), ind === 0 ? 0 : (200/elem.length * ind));
        ctx.lineTo(id === 0 ? 800 : (800 + 200/elem.length * id), 200/map.length * (ind + 1));
        ctx.lineTo(800 + 200/elem.length * (id + 1), 200/map.length * (ind + 1));
        ctx.lineTo(800 + 200/elem.length * (id + 1), ind === 0 ? 0 : (200/elem.length * ind));
        ctx.closePath();
        ctx.stroke();
        if (el === 1) {
          ctx.fillStyle = "rgb(26,26,26)";
          ctx.fill();
        }
        if (ind === playerPlace[0] && id === playerPlace[1]) {
          ctx.fillStyle = "rgb(91,222,86)";
          ctx.fill();
          ctx.beginPath();
          if (playerDirection === 'bottom') {
            ctx.moveTo(800 + 200/elem.length * id, 200/elem.length * ind);
            ctx.lineTo(800 + ((200/elem.length * (id + 1)) + (200/elem.length * id))/2, 200/map.length * (ind + 1));
            ctx.lineTo(800 + 200/elem.length * (id + 1),200/elem.length * ind);
          } else if (playerDirection === 'left') {
            ctx.moveTo(800 + 200/elem.length * (id + 1), 200/elem.length * ind);
            ctx.lineTo(800 + 200/elem.length * id, ((200/elem.length * ind) + (200/elem.length * (ind + 1)))/2);
            ctx.lineTo(800 + 200/elem.length * (id + 1), 200/map.length * (ind + 1));
          } else if (playerDirection === 'up') {
            ctx.moveTo(800 + 200/elem.length * id, 200/map.length * (ind + 1));
            ctx.lineTo(((800 + 200/elem.length * id) + (800 + 200/elem.length * (id + 1)))/2, 200/map.length * ind);
            ctx.lineTo(800 + 200/elem.length * (id + 1), 200/map.length * (ind + 1));
          } else if (playerDirection === 'right') {
            ctx.moveTo(800 + 200/elem.length * id, 200/elem.length * ind);
            ctx.lineTo(800 + 200/elem.length * (id + 1), ((200/elem.length * ind) + (200/elem.length * (ind + 1)))/2);
            ctx.lineTo(800 + 200/elem.length * id, 200/map.length * (ind + 1));
          }
          ctx.closePath();
          ctx.stroke();
        }
      })
    });
  }




  function changeTest(date) {

    date[0][0] = date[1][0];
    date[0][1] = date[1][1];
    date[3][0] = date[2][0];
    date[3][1] = date[2][1];
    date[4][0] = date[5][0];
    date[4][1] = date[5][1];
    date[7][0] = date[6][0];
    date[7][1] = date[6][1];

    date[1][0] = (date[1][0]+500)/2;
    date[1][1] = (date[1][1]+300)/2;

    date[2][0] = (date[2][0]+500)/2;
    date[2][1] = (date[2][1]+300)/2;

    date[5][0] = (date[5][0]+500)/2;
    date[5][1] = (date[5][1]+300)/2;

    date[6][0] = (date[6][0]+500)/2;
    date[6][1] = (date[6][1]+300)/2;
  }

  function oneBlock(date) {
    blockLeftWall(date)
    blockRightWall(date)
    upAndDown(date)
    changeTest(date)
  }








  function move() {
    if (playerDirection === 'bottom') {

      let xDirection = playerPlace[0];
      let yDirection = playerPlace[1];
      let wallBool = false;

      for (xDirection; wallBool === false; xDirection++) {

        if (map[xDirection][yDirection] === 0) {
          if (map[xDirection][yDirection + 1] === 1) {
            blockLeftWall(test)
          } else {
            blockLeftDoor(test)
          }
          if (map[xDirection][yDirection - 1] === 1) {
            blockRightWall(test)
          } else {
            blockRightDoor(test)
          }
        }
        if (map[xDirection + 1][yDirection] === 1){
          wallBool = true
          wall(test)
        }

        upAndDown(test)
        changeTest(test)

      }
    } else if (playerDirection === 'right') {

      let xDirection = playerPlace[0];
      let yDirection = playerPlace[1];
      let wallBool = false;

      for (yDirection; wallBool === false; yDirection++) {

        if (map[xDirection][yDirection] === 0) {
          if (map[xDirection - 1][yDirection] === 1) {
            blockLeftWall(test)
          } else {
            blockLeftDoor(test)
          }
          if (map[xDirection + 1][yDirection] === 1) {
            blockRightWall(test)
          } else {
            blockRightDoor(test)
          }
        }
        if (map[xDirection][yDirection + 1] === 1){
          wallBool = true
          wall(test)
        }

        upAndDown(test)
        changeTest(test)

      }
    } else if (playerDirection === 'up') {

      let xDirection = playerPlace[0];
      let yDirection = playerPlace[1];
      let wallBool = false;

      for (xDirection; wallBool === false; xDirection--) {

        if (map[xDirection][yDirection] === 0) {
          if (map[xDirection][yDirection - 1] === 1) {
            blockLeftWall(test)
          } else {
            blockLeftDoor(test)
          }
          if (map[xDirection][yDirection + 1] === 1) {
            blockRightWall(test)
          } else {
            blockRightDoor(test)
          }
        }
        if (map[xDirection - 1][yDirection] === 1){
          wallBool = true
          wall(test)
        }

        upAndDown(test)
        changeTest(test)

      }
    } else if (playerDirection === 'left') {

      let xDirection = playerPlace[0];
      let yDirection = playerPlace[1];
      let wallBool = false;

      for (yDirection; wallBool === false; yDirection--) {

        if (map[xDirection][yDirection] === 0) {
          if (map[xDirection + 1][yDirection] === 1) {
            blockLeftWall(test)
          } else {
            blockLeftDoor(test)
          }
          if (map[xDirection - 1][yDirection] === 1) {
            blockRightWall(test)
          } else {
            blockRightDoor(test)
          }
        }
        if (map[xDirection][yDirection - 1] === 1){
          wallBool = true
          wall(test)
        }

        upAndDown(test)
        changeTest(test)

      }
    }

    drawMap()

    test = [
      [0, 0],
      [250, 150],
      [250, 450],
      [0, 600],
      [1000, 0],
      [750, 150],
      [750, 450],
      [1000, 600],
    ]
  }


  document.addEventListener("keydown", (e) => {
    if (e.key === 'ArrowUp') {
      if (playerDirection === 'bottom') {
        if (map[playerPlace[0] + 1][playerPlace[1]] === 0) {
          playerPlace[0] = playerPlace[0] + 1
        }
      } else if (playerDirection === 'right') {
        if (map[playerPlace[0]][playerPlace[1] + 1] === 0) {
          playerPlace[1] = playerPlace[1] + 1
        }
      } else if (playerDirection === 'up') {
        if (map[playerPlace[0] - 1][playerPlace[1]] === 0) {
          playerPlace[0] = playerPlace[0] - 1
        }
      } else if (playerDirection === 'left') {
        if (map[playerPlace[0]][playerPlace[1] - 1] === 0) {
          playerPlace[1] = playerPlace[1] - 1
        }
      }
      move()
      drawMap()
    } else if (e.key === 'ArrowDown') {
      if (playerDirection === 'bottom') {
        if (map[playerPlace[0] - 1][playerPlace[1]] === 0) {
          playerPlace[0] = playerPlace[0] - 1
        }
      } else if (playerDirection === 'right') {
        if (map[playerPlace[0]][playerPlace[1] - 1] === 0) {
          playerPlace[1] = playerPlace[1] - 1
        }
      } else if (playerDirection === 'up') {
        if (map[playerPlace[0] + 1][playerPlace[1]] === 0) {
          playerPlace[0] = playerPlace[0] + 1
        }
      } else if (playerDirection === 'left') {
        if (map[playerPlace[0]][playerPlace[1] + 1] === 0) {
          playerPlace[1] = playerPlace[1] + 1
        }
      }
      move()
      drawMap()
    }
    else if (e.key === 'ArrowLeft') {
      if (playerDirection === 'bottom') {
        playerDirection = 'right'
      } else if (playerDirection === 'right') {
        playerDirection = 'up'
      } else if (playerDirection === 'up') {
        playerDirection = 'left'
      } else if (playerDirection === 'left') {
        playerDirection = "bottom"
      }
      move()
      drawMap()
    } else if (e.key === 'ArrowRight') {
      if (playerDirection === 'bottom') {
        playerDirection = 'left'
      } else if (playerDirection === 'left') {
        playerDirection = 'up'
      } else if (playerDirection === 'up') {
        playerDirection = 'right'
      } else if (playerDirection === 'right') {
        playerDirection = "bottom"
      }
      move()
      drawMap()
    }
    if (playerPlace[0] === win[0] && playerPlace[1] === win[1]) {
      alert('Ты ПОБЕДИЛ!!!')
    }
  })

  move()
  drawMap()

</script>
</body>
</html>